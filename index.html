<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NutriMate: Created by Ishaan and Atharv</title>

<style>
  body {
    font-family: Poppins, system-ui;
    background: linear-gradient(135deg, #0f1724, #0b1220);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    padding: 20px;
  }

  .card {
    width: 520px;
    max-width: 96%;
    background: rgba(255, 255, 255, 0.03);
    padding: 18px;
    border-radius: 14px;
    backdrop-filter: blur(8px);
    box-shadow: 0 10px 40px rgba(0, 0, 0, .6);
    border: 1px solid rgba(255, 255, 255, 0.04);
  }

  h1 {
    margin: 0 0 12px;
    font-size: 20px;
    text-align: center;
  }

  #chat {
    height: 380px;
    overflow-y: auto;
    padding: 12px;
    border-radius: 10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  }

  .bubble {
    max-width: 82%;
    padding: 10px;
    border-radius: 12px;
    margin: 8px 0;
    white-space: pre-wrap;
  }

  .user {
    margin-left: auto;
    background: linear-gradient(145deg, #00e6a1, #00c487);
    color: #002b20;
  }

  .bot {
    background: linear-gradient(145deg, #4c51ff, #7a81ff);
    color: white;
  }

  #promptArea {
    margin-top: 12px;
    display: flex;
    gap: 8px;
    align-items: center;
  }

  input, select {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, .06);
    background: rgba(255, 255, 255, .02);
    color: #fff;
  }

  button {
    padding: 10px 12px;
    border-radius: 8px;
    border: none;
    background: #fff;
    color: #000;
    cursor: pointer;
    font-weight: 700;
  }
</style>
</head>

<body>
<div class="card">
  <h1>üçè Smart DietBot ‚Äî Exhibition</h1>
  <div id="chat" role="log" aria-live="polite"></div>
  <div id="promptArea"></div>
</div>

<script type="module">

// ‚úÖ Your OpenAI-compatible key
const OPENAI_API_KEY = "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";

// ‚úÖ Proxy endpoint (Groq-compatible)
const API_URL = "https://api.groq.com/openai/v1/chat/completions";

const chat = document.getElementById("chat");
const promptArea = document.getElementById("promptArea");

function append(role, text) {
  const bubble = document.createElement("div");
  bubble.className = `bubble ${role}`;
  bubble.textContent = text || "Error: Empty response";
  chat.appendChild(bubble);
  chat.scrollTop = chat.scrollHeight;
}

const questions = [
  { key: "name", q: "What is your name?", type: "text" },
  { key: "age", q: "Age?", type: "number" },
  { key: "gender", q: "Gender?", type: "select", options: ["Male","Female","Other"] },
  { key: "height_cm", q: "Height (cm)?", type: "number" },
  { key: "weight_kg", q: "Weight (kg)?", type: "number" },
  { key: "dietType", q: "Diet preference?", type: "select", options: ["Veg","Non-Veg","Vegan","Other"] },
  { key: "allergies", q: "Any allergies?", type: "text" },
  { key: "activity", q: "Activity level?", type: "select", options: ["Low","Moderate","High"] },
  { key: "region", q: "Region preference?", type: "text" },
  { key: "goal", q: "Main goal?", type: "text" },
];

const answers = {};
let index = 0;

function renderQuestion(i) {
  promptArea.innerHTML = "";
  const q = questions[i];

  append("bot", q.q);

  let input = (q.type === "select")
    ? createSelect(q.options)
    : createInput(q.type);

  input.id = "answerInput";
  promptArea.appendChild(input);

  const btn = document.createElement("button");
  btn.textContent = (i === questions.length - 1) ? "Submit" : "Next";
  btn.onclick = handleAnswer;
  promptArea.appendChild(btn);

  input.focus();
  input.addEventListener("keydown", e => e.key === "Enter" && handleAnswer());
}

function createInput(type) {
  const inp = document.createElement("input");
  inp.type = type === "number" ? "number" : "text";
  return inp;
}

function createSelect(opts) {
  const sel = document.createElement("select");
  opts.forEach(o => {
    const op = document.createElement("option");
    op.value = o;
    op.textContent = o;
    sel.appendChild(op);
  });
  return sel;
}

function handleAnswer() {
  const el = document.getElementById("answerInput");
  const val = el.value.trim() || "None";
  append("user", val);

  answers[questions[index].key] = val;
  index++;

  if (index < questions.length) {
    renderQuestion(index);
  } else {
    promptArea.innerHTML = "";
    append("bot", "Generating your perfect diet‚Ä¶ üçΩÔ∏è");
    generateDiet();
  }
}

async function generateDiet() {
  const diet = answers.dietType.toLowerCase();
  const rules =
    diet === "veg" ? "Include paneer/curd. Avoid tofu." :
    diet === "vegan" ? "Exclude dairy. Use soy/almond milk." : "";

  const prompt = `
You are a certified nutritionist.
Generate a 1-day personalized INDIAN balanced diet:

Name: ${answers.name}
Age: ${answers.age}
Gender: ${answers.gender}
Height: ${answers.height_cm} cm
Weight: ${answers.weight_kg} kg
Diet type: ${answers.dietType}
Allergies: ${answers.allergies}
Activity: ${answers.activity}
Region: ${answers.region}
Goal: ${answers.goal}

RULES:
${rules}

Include:
‚Ä¢ Breakfast
‚Ä¢ Mid-meal
‚Ä¢ Lunch
‚Ä¢ Evening Snack
‚Ä¢ Dinner
‚Ä¢ Water intake target
‚Ä¢ Restrictions
‚Ä¢ Approx calories
Keep portions realistic. No dish repetition.
`;

  try {
    const resp = await fetch(API_URL, {
      method: "POST",
      headers: {
        Authorization: `Bearer ${OPENAI_API_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        model: "llama-3.1-8b-instant",
        messages: [{ role: "user", content: prompt }],
        temperature: 0.7,
      }),
    });

    const data = await resp.json();
    const text = data?.choices?.[0]?.message?.content ?? "Failed to generate.";
    append("bot", text);

  } catch (err) {
    append("bot", "‚ö† Network/API error.");
  }
}

// Start chatbot
append("bot", "Hi! Answer a few questions and I‚Äôll build your perfect diet üòé");
renderQuestion(0);

</script>
</body>
</html>
